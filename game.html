<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    body { text-align:center; font-family:Arial; }
    .card { border:2px solid black; width:250px; margin:20px auto; padding:20px; border-radius:8px; background:#f8f8f8; }
    .role-good { color:blue; font-size:2em; font-weight:bold; }
    .role-bad { color:red; font-size:2em; font-weight:bold; }
    .alive-list { margin-top:20px; text-align:left; max-width:300px; margin-left:auto; margin-right:auto; }
  </style>
</head>
<body>
  <h1>ğŸ­ ç©å®¶é  - å‰©é¤˜èº«åˆ†</h1>
  <div id="player-card"></div>
  <div class="alive-list" id="alive-roles"></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const playerId = Number(urlParams.get("player"));
    const gameId = Number(urlParams.get("gameId"));
    const cardDiv = document.getElementById("player-card");
    const aliveDiv = document.getElementById("alive-roles");

    if(!playerId || !gameId){
      cardDiv.innerHTML = "<p>è«‹å¾ä¸»æŒäººé æ‰“é–‹</p>";
    } else {
      function refresh(){
        google.script.run.withSuccessHandler(info=>{
          if(!info){ cardDiv.innerHTML="<p>éŠæˆ²å°šæœªå»ºç«‹</p>"; return; }

          const player = info.player;
          const allPlayers = info.players;

          // é¡¯ç¤ºè‡ªå·±è§’è‰²
          let roleClass = player.role==="ç‹¼äºº"?"role-bad":"role-good";
          cardDiv.innerHTML = `<div class="card">
            <h3>ç©å®¶ ${player.id}</h3>
            <div class="${roleClass}">${player.role}</div>
            <p>ç‹€æ…‹ï¼š${player.alive?"å­˜æ´»":"æ­»äº¡"}</p>
          </div>`;

          // å ´ä¸Šå‰©é¤˜èº«åˆ†
          const alivePlayers = allPlayers.filter(p=>p.alive);
          aliveDiv.innerHTML = "<b>å ´ä¸Šå‰©é¤˜èº«åˆ†ï¼š</b><br>" + alivePlayers.map(p=>{
            const color = p.role==="ç‹¼äºº"?"red":"blue";
            return `<span style="color:${color}">ç©å®¶ ${p.id} (${p.role})</span>`;
          }).join("<br>");

        }).getPlayerInfo(gameId, playerId);
      }

      refresh();
      setInterval(refresh,5000);
    }
  </script>
</body>
</html>
aliveDiv.innerHTML += `<br><br><b>ğŸ† å‹åˆ©æ–¹ï¼š${winner}</b>`;
